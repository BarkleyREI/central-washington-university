!function(){"use strict";window.matchMedia("(min-width: 400px)"),window.matchMedia("(min-width: 768px)"),window.matchMedia("(min-width: 1024px)"),window.matchMedia("(min-width: 1200px)"),window.matchMedia("(min-width: 1440px)"),window.matchMedia("(min-width: 1920px)");const e=function(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))};Object.assign;function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var n={elem:{$checkboxes:$(".filter__item--checkboxes"),$chips:$(".aggregate__chips"),$count:$(".aggregate__count"),$keywords:$(".keyword"),$loading:$(".aggregate__loading"),$pagination:$(".aggregate__pagination"),$reset:$(".aggregate__reset"),$results:$(".aggregate__results"),$selects:$(".filter-selectbox")},dataSource:null,filters:{},initial:!0,results:"",suggestions:"",init:function(){this.dataSource=this.elem.$results.data("src"),this.buildFilters(),this.getQuery(),this.setControls(),this.buildChips(),this.setQuery(!1,!1),window.onpopstate=this.filterState,this.elem.$reset.on("click",this.filterReset)},bindUIActions:function(){this.elem.$checkboxes.find("input").on("change",this.filterCheckbox),this.elem.$keywords.find("button").on("click",this.filterKeyword),this.elem.$keywords.find("input").on("keydown",this.filterKeyword),this.elem.$selects.find("select").on("change",this.filterSelect)},unbindUIActions:function(){this.elem.$checkboxes.find("input").off("change"),this.elem.$keywords.find("button").off("click"),this.elem.$selects.find("select").off("change",this.filterSelect)},addChip:function(e,t){var i='<a href="#'+e+'" class="chip"><span class="chip__close"><span class="show-for-sr">Remove this filter</span><svg class="brei-icon brei-icon-close" focusable="false"><use href="#brei-icon-close"></use></svg></span><span class="chip__label">'+t+"</span></a>";n.elem.$chips.prepend(i),$('.chip[href="#'+e+'"]').on("click",n.unfilterChip)},removeChip:function(e){$('.chip[href="#'+e+'"]').remove()},unfilterChip:function(e){e.preventDefault();var t=e.currentTarget.hash,i=t.substr(1);"checkbox"===$(t)[0].type&&$(t).trigger("click"),"search"===$(t)[0].type&&($(e.currentTarget).remove(),$(t)[0].value="",n.filters[i]="",n.filters.pageindex=0,n.setQuery(!0,!0)),"select"===$(t)[0].localName&&($(t)[0].selectedIndex=-1,$(t).siblings(".selectability").find('[role="textbox"]')[0].innerHTML="",$(t).trigger("change").removeClass("js-selectability--has-value"))},buildChips:function(){for(var e in n.filters){var t="#"+e,i="";if(n.filters.hasOwnProperty(e))if(Array.isArray(n.filters[e])){if(n.filters[e].length>0)for(var r=0;r<n.filters[e].length;r+=1){var s=$('[id^="'+e+'"][value="'+n.filters[e][r]+'"]');i=s.siblings("label")[0].innerText,n.addChip(s.attr("id"),i)}}else"pageindex"!==e&&"pagesize"!==e&&""!==n.filters[e]&&("input"===$(t)[0].localName&&(i=$(t)[0].value),"select"===$(t)[0].localName&&(i=$(t)[0].options[$(t)[0].selectedIndex].text),n.addChip(e,i))}},buildFilters:function(){n.elem.$keywords.length>0&&(n.filters.search=""),n.elem.$checkboxes.length>0&&n.elem.$checkboxes.each((function(){n.filters[$(this).find("legend")[0].innerText]=[]})),n.elem.$keywords.length>0&&n.elem.$keywords.each((function(){n.filters[$(this).find("input")[0].id]=""})),n.elem.$selects.length>0&&n.elem.$selects.each((function(){n.filters[$(this).find("select")[0].id]=""})),n.filters.pageindex=0,n.filters.pagesize=10},buildQuery:function(){var e=this.filters,t=[];for(var i in e)e.hasOwnProperty(i)&&(Array.isArray(i)&&(e[i]=i.toString()),t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])));return t=t.join("&").replace(/%2C/g,",")},filterCheckbox:function(e){var t=e.currentTarget.id,i=t.substring(0,e.currentTarget.id.indexOf("-")),r=e.currentTarget.value,s=$(e.currentTarget).siblings("label")[0].innerText;e.currentTarget.checked?(n.addChip(t,s),n.filters[i].push(r)):(n.removeChip(t),n.filters[i].splice(n.filters[i].indexOf(r),1)),n.filters.pageindex=0,n.setQuery(!0,!0)},filterKeyword:function(e){var t=!1,i="";if("keydown"===e.type&&13===e.keyCode&&(i=$(e.currentTarget)[0].id,t=!0),"click"===e.type&&(i=$(e.currentTarget).siblings("input")[0].id,t=!0),t){e.preventDefault();var r="<span>"+$("#"+i)[0].value.trim()+"</span>",s=$(r).text();s.length>0&&(n.removeChip(i),n.addChip(i,s),n.filters[i]=s,n.filters.pageindex=0,n.setQuery(!0,!0))}},filterPagination:function(e){e.preventDefault(),n.filters.pageindex=e.currentTarget.hash.substr(1),n.setQuery(!0,!0)},filterReset:function(){n.unbindUIActions(),n.elem.$checkboxes.find("input").prop("checked",!1),n.elem.$keywords.find("input").val(""),n.elem.$selects.length>0&&(n.elem.$selects.find("select")[0].selectedIndex=-1,n.elem.$selects.find("select").siblings(".selectability").find('[role="textbox"]').html(""),n.elem.$selects.find("select").removeClass("js-selectability--has-value")),$(".chip").remove(),n.buildFilters(),n.setQuery(!0,!0)},filterSelect:function(e){e.preventDefault();var t=e.currentTarget.id,i=e.currentTarget.value;if(n.removeChip(t),e.currentTarget.selectedIndex>-1){var r=e.currentTarget.options[e.currentTarget.selectedIndex].text;$(e.currentTarget).siblings(".selectability").find('[role="textbox"]')[0].innerHTML=r,n.addChip(t,r)}n.filters[t]=i,n.filters.pageindex=0,n.setQuery(!0,!0)},filterState:function(){n.getQuery(),n.setControls(),n.setQuery(!1,!1)},getData:function(e){var t=$.Deferred();return $.ajax({url:n.dataSource,method:"GET",data:e,dataType:"html",success:function(e){t.resolve(e)},error:function(e,i,n){console.log(e,n),t.reject(i)}}),t.promise()},getQuery:function(){window.location.search.length>0&&new URLSearchParams(window.location.search).forEach((function(e,t){""!==e&&void 0!==n.filters[t]&&(Array.isArray(n.filters[t])?(n.filters[t]=[],e=e.split(","),n.filters[t]=e):n.filters[t]=e)}))},renderCount:function(){var e=parseInt(n.filters.pageindex)*parseInt(n.filters.pagesize)+1,t=e+parseInt(n.filters.pagesize)-1;t>n.results[0].TotalCount&&(t=n.results[0].TotalCount),1!==parseInt(t)?(e+="-",e+=t,e+=" of ",e+=n.results[0].TotalCount,e+=" Results"):e+=" Result",n.elem.$count.html(e)},renderPagination:function(){var e=[],i=n.filters,r=parseInt(i.pageindex),s=Math.ceil(parseInt(n.results[0].TotalCount)/parseInt(i.pagesize))-1,a='<ul class="pagination__list clearfix" aria-label="Pagination">';e.push(0,r-1,r,r+1,s),r<2&&e.push(2),r>s-1&&e.push(s-2),e=(e=e.filter((function(e){return e>-1}))).filter((function(e){return e<=s})),e=(e=t(new Set(e))).sort((function(e,t){return e-t})),a+='<li class="pagination__item pagination__item--prev',0===r&&(a+=" pagination__item--disabled"),a+='"><a href="#'+(r-1)+'" class="pagination__button btn btn--pagination"><span class="btn__icon"><svg class="brei-icon brei-icon-chevron" focusable="false"><use href="#brei-icon-chevron"></use></svg></span><span class="show-for-sr">Previous Page</span></a></li>';for(var l=0;l<e.length;l+=1)if(0===l||e[l]!==e[l-1])if(l>0&&e[l]-e[l-1]>1&&(a+='<li class="pagination__item pagination__item--spacer"><span class="pagination__span">...</span></li>'),e[l]===r)a+='<li class="pagination__item pagination__item--active"><a href="#'+e[l]+'" class="pagination__link" tabindex="-1"><span class="show-for-sr">You\'re on page</span> '+(e[l]+1)+"</a></li>";else{var o="";0===l&&(o=" pagination__item--first"),l===e.length-1&&(o=" pagination__item--last"),a+='<li class="pagination__item'+o+'"><a href="#'+e[l]+'" class="pagination__link" aria-label="Page '+(e[l]+1)+'">'+(e[l]+1)+"</a></li>"}a+='<li class="pagination__item pagination__item--next',r===s&&(a+=" pagination__item--disabled"),a+='"><a href="#'+(r+1)+'" class="pagination__button btn btn--pagination"><span class="btn__icon"><svg class="brei-icon brei-icon-chevron" focusable="false"><use href="#brei-icon-chevron"></use></svg></span><span class="show-for-sr">Previous Page</span></a></li></ul>',n.elem.$pagination.html(a),$(".pagination__button, .pagination__link").on("click",n.filterPagination)},renderResults:function(){n.elem.$loading.hide(),!1===n.initial&&(0===$(".aggregate__chips").children().length&&0===parseInt(n.filters.pageindex)?$(".aggregate__feature").show():$(".aggregate__feature").hide()),n.results[0].TotalCount>0?(n.filters.pagesize=parseInt(n.results[0].PageSize),n.renderCount(),n.elem.$count.fadeIn(),n.elem.$results.html(n.results[0].Results).fadeIn(),n.results[0].TotalCount>n.filters.pagesize&&(n.renderPagination(),n.elem.$pagination.fadeIn())):n.elem.$results.html('<p class="aggregate__none">No matching results were found.</p>').fadeIn(),n.initial=!1},setControls:function(){for(var e in n.unbindUIActions(),n.elem.$checkboxes.find("input").prop("checked",!1),n.filters)if(n.filters.hasOwnProperty(e))if(Array.isArray(n.filters[e]))for(var t=0;t<n.filters[e].length;t+=1){$('[id^="'+e+'"][value="'+n.filters[e][t]+'"]').prop("checked",!0)}else if("pageindex"!==e&&"pagesize"!==e&&""!==n.filters[e]){var i="#"+e;"input"===$(i)[0].localName&&($(i)[0].value=n.filters[e]),"select"===$(i)[0].localName&&$(i).val(n.filters[e]).trigger("change").addClass("js-selectability--has-value")}n.bindUIActions()},setQuery:function(e,t){var i=n.buildQuery(),r=n.getData(i);!0===e&&$("html, body").animate({scrollTop:$(".aggregate__content").offset().top},425),!0===t?history.pushState(null,"","?"+i):history.replaceState(null,"","?"+i),n.elem.$loading.show(),n.elem.$count.fadeOut().empty(),n.elem.$results.fadeOut().empty(),n.elem.$pagination.fadeOut().empty(),$.when(r).done((function(e){setTimeout((function(){n.results=JSON.parse(e),n.renderResults()}),500)})).fail((function(){console.log("API ERROR: No results were returned")}))}},r=function(){n.init()};e((function(){r()}))}();
//# sourceMappingURL=aggregate.js.map