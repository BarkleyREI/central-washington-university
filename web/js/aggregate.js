!function(){"use strict";window.matchMedia("(min-width: 400px)"),window.matchMedia("(min-width: 768px)"),window.matchMedia("(min-width: 1024px)"),window.matchMedia("(min-width: 1200px)"),window.matchMedia("(min-width: 1440px)"),window.matchMedia("(min-width: 1920px)");const e=function(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))};Object.assign;var t={elem:{$checkboxes:$(".filter__item--checkboxes"),$chips:$(".aggregate__chips"),$count:$(".aggregate__count"),$keywords:$(".keyword"),$loading:$(".aggregate__loading"),$pagination:$(".aggregate__pagination"),$reset:$(".aggregate__reset"),$results:$(".aggregate__results"),$selects:$(".filter-selectbox")},dataSource:null,filters:{},initial:!0,results:"",suggestions:"",init:function(){this.dataSource=this.elem.$results.data("src"),this.buildFilters(),this.getQuery(),this.setControls(),this.buildChips(),this.setQuery(!1,!1),window.onpopstate=this.filterState,this.elem.$reset.on("click",this.filterReset)},bindUIActions:function(){this.elem.$checkboxes.find("input").on("change",this.filterCheckbox),this.elem.$keywords.find("button").on("click",this.filterKeyword),this.elem.$keywords.find("input").on("keydown",this.filterKeyword),this.elem.$selects.find("select").on("change",this.filterSelect)},unbindUIActions:function(){this.elem.$checkboxes.find("input").off("change"),this.elem.$keywords.find("button").off("click"),this.elem.$selects.find("select").off("change",this.filterSelect)},addChip:function(e,i){var n='<a href="#'+e+'" class="chip"><span class="chip__close"><span class="show-for-sr">Remove this filter</span><svg class="brei-icon brei-icon-close" focusable="false"><use xlink:href="#brei-icon-close"></use></svg></span><span class="chip__label">'+i+"</span></a>";t.elem.$chips.prepend(n),$('.chip[href="#'+e+'"]').on("click",t.unfilterChip)},removeChip:function(e){$('.chip[href="#'+e+'"]').remove()},unfilterChip:function(e){e.preventDefault();var i=e.currentTarget.hash,n=i.substr(1);"checkbox"===$(i)[0].type&&$(i).trigger("click"),"search"===$(i)[0].type&&($(e.currentTarget).remove(),$(i)[0].value="",t.filters[n]="",t.filters.pageindex=0,t.setQuery(!0,!0)),"select"===$(i)[0].localName&&($(i)[0].selectedIndex=-1,$(i).siblings(".selectability").find('[role="textbox"]')[0].innerHTML="",$(i).trigger("change").removeClass("js-selectability--has-value"))},buildChips:function(){for(var e in t.filters){var i="#"+e,n="";if(t.filters.hasOwnProperty(e))if(Array.isArray(t.filters[e])){if(t.filters[e].length>0)for(var s=0;s<t.filters[e].length;s+=1){var a=$('[id^="'+e+'"][value="'+t.filters[e][s]+'"]');n=a.siblings("label")[0].innerText,t.addChip(a.attr("id"),n)}}else"pageindex"!==e&&"pagesize"!==e&&""!==t.filters[e]&&("input"===$(i)[0].localName&&(n=$(i)[0].value),"select"===$(i)[0].localName&&(n=$(i)[0].options[$(i)[0].selectedIndex].text),t.addChip(e,n))}},buildFilters:function(){t.elem.$keywords.length>0&&(t.filters.search=""),t.elem.$checkboxes.length>0&&t.elem.$checkboxes.each((function(){t.filters[$(this).find("legend")[0].innerText]=[]})),t.elem.$keywords.length>0&&t.elem.$keywords.each((function(){t.filters[$(this).find("input")[0].id]=""})),t.elem.$selects.length>0&&t.elem.$selects.each((function(){t.filters[$(this).find("select")[0].id]=""})),t.filters.pageindex=0,t.filters.pagesize=10},buildQuery:function(){var e=this.filters,t=[];for(var i in e)e.hasOwnProperty(i)&&(Array.isArray(i)&&(e[i]=i.toString()),t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])));return t=t.join("&").replace(/%2C/g,",")},filterCheckbox:function(e){var i=e.currentTarget.id,n=i.substring(0,e.currentTarget.id.indexOf("-")),s=e.currentTarget.value,a=$(e.currentTarget).siblings("label")[0].innerText;e.currentTarget.checked?(t.addChip(i,a),t.filters[n].push(s)):(t.removeChip(i),t.filters[n].splice(t.filters[n].indexOf(s),1)),t.filters.pageindex=0,t.setQuery(!0,!0)},filterKeyword:function(e){var i=!1,n="";if("keydown"===e.type&&13===e.keyCode&&(n=$(e.currentTarget)[0].id,i=!0),"click"===e.type&&(n=$(e.currentTarget).siblings("input")[0].id,i=!0),i){e.preventDefault();var s="<span>"+$("#"+n)[0].value.trim()+"</span>",a=$(s).text();a.length>0&&(t.removeChip(n),t.addChip(n,a),t.filters[n]=a,t.filters.pageindex=0,t.setQuery(!0,!0))}},filterPagination:function(e){e.preventDefault(),t.filters.pageindex=e.currentTarget.hash.substr(1),t.setQuery(!0,!0)},filterReset:function(){t.unbindUIActions(),t.elem.$checkboxes.find("input").prop("checked",!1),t.elem.$keywords.find("input").val(""),t.elem.$selects.length>0&&(t.elem.$selects.find("select")[0].selectedIndex=-1,t.elem.$selects.find("select").siblings(".selectability").find('[role="textbox"]').html(""),t.elem.$selects.find("select").removeClass("js-selectability--has-value")),$(".chip").remove(),t.buildFilters(),t.setQuery(!0,!0)},filterSelect:function(e){e.preventDefault();var i=e.currentTarget.id,n=e.currentTarget.value;if(t.removeChip(i),e.currentTarget.selectedIndex>-1){var s=e.currentTarget.options[e.currentTarget.selectedIndex].text;$(e.currentTarget).siblings(".selectability").find('[role="textbox"]')[0].innerHTML=s,t.addChip(i,s)}t.filters[i]=n,t.filters.pageindex=0,t.setQuery(!0,!0)},filterState:function(){t.getQuery(),t.setControls(),t.setQuery(!1,!1)},getData:function(e){var i=$.Deferred();return $.ajax({url:t.dataSource,method:"GET",data:e,dataType:"html",success:function(e){i.resolve(e)},error:function(e,t,n){console.log(e,n),i.reject(t)}}),i.promise()},getQuery:function(){window.location.search.length>0&&new URLSearchParams(window.location.search).forEach((function(e,i){""!==e&&void 0!==t.filters[i]&&(Array.isArray(t.filters[i])?(t.filters[i]=[],e=e.split(","),t.filters[i]=e):t.filters[i]=e)}))},renderCount:function(){var e=parseInt(t.filters.pageindex)*parseInt(t.filters.pagesize)+1,i=e+parseInt(t.filters.pagesize)-1;i>t.results[0].TotalCount&&(i=t.results[0].TotalCount),1!==parseInt(i)?(e+="-",e+=i,e+=" of ",e+=t.results[0].TotalCount,e+=" Results"):e+=" Result",t.elem.$count.html(e)},renderPagination:function(){var e=[],i=t.filters,n=parseInt(i.pageindex),s=Math.ceil(parseInt(t.results[0].TotalCount)/parseInt(i.pagesize))-1,a='<ul class="pagination__list clearfix" aria-label="Pagination">';e.push(0,n-1,n,n+1,s),n<2&&e.push(2),n>s-1&&e.push(s-2),(e=(e=e.filter((function(e){return e>-1}))).filter((function(e){return e<=s}))).sort((function(e,t){return e-t})),a+='<li class="pagination__item pagination__item--prev',0===n&&(a+=" pagination__item--disabled"),a+='"><a href="#'+(n-1)+'" class="pagination__button btn btn--pagination"><span class="btn__icon"><svg class="brei-icon brei-icon-chevron" focusable="false"><use xlink:href="#brei-icon-chevron"></use></svg></span><span class="show-for-sr">Previous Page</span></a></li>';for(var r=0;r<e.length;r+=1)if(0===r||e[r]!==e[r-1])if(r>0&&e[r]-e[r-1]>1&&(a+='<li class="pagination__item pagination__item--spacer"><span class="pagination__span">...</span></li>'),e[r]===n)a+='<li class="pagination__item pagination__item--active"><a href="#'+e[r]+'" class="pagination__link" tabindex="-1"><span class="show-for-sr">You\'re on page</span> '+(e[r]+1)+"</a></li>";else{var l="";0===r&&(l=" pagination__item--first"),r===e.length-1&&(l=" pagination__item--last"),a+='<li class="pagination__item'+l+'"><a href="#'+e[r]+'" class="pagination__link" aria-label="Page '+(e[r]+1)+'">'+(e[r]+1)+"</a></li>"}a+='<li class="pagination__item pagination__item--next',n===s&&(a+=" pagination__item--disabled"),a+='"><a href="#'+(n+1)+'" class="pagination__button btn btn--pagination"><span class="btn__icon"><svg class="brei-icon brei-icon-chevron" focusable="false"><use xlink:href="#brei-icon-chevron"></use></svg></span><span class="show-for-sr">Previous Page</span></a></li></ul>',t.elem.$pagination.html(a),$(".pagination__button, .pagination__link").on("click",t.filterPagination)},renderResults:function(){t.elem.$loading.hide(),!1===t.initial&&$(".aggregate__feature").empty(),t.results[0].TotalCount>0?(t.filters.pagesize=parseInt(t.results[0].PageSize),t.renderCount(),t.elem.$count.fadeIn(),t.elem.$results.html(t.results[0].Results).fadeIn(),t.results[0].TotalCount>t.filters.pagesize&&(t.renderPagination(),t.elem.$pagination.fadeIn())):t.elem.$results.html('<p class="aggregate__none">No matching results were found.</p>').fadeIn(),t.initial=!1},setControls:function(){for(var e in t.unbindUIActions(),t.elem.$checkboxes.find("input").prop("checked",!1),t.filters)if(t.filters.hasOwnProperty(e))if(Array.isArray(t.filters[e]))for(var i=0;i<t.filters[e].length;i+=1){$('[id^="'+e+'"][value="'+t.filters[e][i]+'"]').prop("checked",!0)}else if("pageindex"!==e&&"pagesize"!==e&&""!==t.filters[e]){var n="#"+e;"input"===$(n)[0].localName&&($(n)[0].value=t.filters[e]),"select"===$(n)[0].localName&&$(n).val(t.filters[e]).trigger("change").addClass("js-selectability--has-value")}t.bindUIActions()},setQuery:function(e,i){var n=t.buildQuery(),s=t.getData(n);!0===e&&$("html, body").animate({scrollTop:$(".aggregate__content").offset().top},425),!0===i?history.pushState(null,"","?"+n):history.replaceState(null,"","?"+n),t.elem.$loading.show(),t.elem.$count.fadeOut().empty(),t.elem.$results.fadeOut().empty(),t.elem.$pagination.fadeOut().empty(),$.when(s).done((function(e){setTimeout((function(){t.results=JSON.parse(e),t.renderResults()}),500)})).fail((function(){console.log("API ERROR: No results were returned")}))}},i=function(){t.init()};e((function(){i()}))}();
//# sourceMappingURL=aggregate.js.map